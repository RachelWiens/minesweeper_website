<!DOCTYPE html>
<html>
<head>
  <meta content="text/html;charset=utf-8" http-equiv="content-type">
  <meta content="utf-8" http-equiv="encoding">
  <link rel="stylesheet" type="text/css" href="main.css">
  <script type="text/javascript" src="tile.js"></script>
  <script type="text/javascript" src="board.js"></script>
  <script type="text/javascript" src="minesweeper.js"></script>
  <title>Rachel Wiens</title>
  <script>
    const boardHeight = 10;
    const boardLength = 10;
    const numMines = 30;

    // Align elements
    function doOnLoad() {
      var game = new Minesweeper(boardHeight, boardLength, numMines);
      createBoard(game);
    }

    /**
     * Create the HTML board and return a 2D array containing all the buttons
     * @param {Minesweeper} game
     */
    function createBoard(game) {
      // TODO: Replace with JQuery template
      var board_btns = [];
      var table = document.getElementById('minesweeper_table');
      for (var i=0; i<boardHeight; i++) {
        board_btns[i] = [];
        var row = table.insertRow(-1);
        for (var j=0; j<boardLength; j++) {
          var cell = row.insertCell(j);
          var button = document.createElement("button");
          button.type = "button";
          button.id = "btn" + i + j;
          button.className = "ms_tile_btn";
          // When a button is clicked, make that move and update the board.
          button.onclick = (function(x, y, btn) {
            // Return a function that has variables x and y in local scope.
            return function() {
              // TODO: Implement button right click calls
              if( game.makeMove(x, y)) {  // If move is valid.
                // TODO: Game over logic.
                var tile = (game.getBoard())[x][y];
                btn.innerHTML = tile.toString();
                btn.disabled = true;
                // If tile is empty, show all tiles around it.
                if( tile == Tile.TileEnum.EMPTY ){
                  for( var k=-1; k<2; k++ ){
                    for( var l=-1; l<2; l++ ){
                      // TODO: showTile(x+i, y+j);
                    }
                  }
                }
              }
            }
          })(i, j, button);
          cell.appendChild(button);
          board_btns[i][j] = button;
        }
      }
      return board_btns;
    }

    // nuke and reinitialize board
    function clearBoard(){
        var table = document.getElementById('minesweeper_table');
        table.innerHTML = "";
        var game = new Minesweeper(boardHeight, boardLength, numMines);
        createBoard(game);
    }

  </script>
</head>

<body onload="doOnLoad()">

  <div id="toolbar_div">
    <nav>
      <!-- Replace with actual navigation buttons, no br -->
      <a href="">Home</a><br>
      <a href="">Bio</a><br>
      <a href="">Resume</a><br>
      <a href="">Code</a><br>
      <a href="https://rainspeak.deviantart.com">Art</a><br>
    </nav>
  </div>

  <div id="main_div">
    <p>main</p>
    <table id="minesweeper_table">

    </table>
  </div>

</body>
</html>
